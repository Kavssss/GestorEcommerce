package backend.repositories.item;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import backend.entities.ItemEntity;
import models.DAO;
import models.DbException;

public class ItemRepositoryImpl extends DAO implements ItemRepository {

	PreparedStatement preparedStatement;
	ResultSet resultSet;
	
	@Override
	public ItemEntity findById(Long id) throws SQLException {
		String sql = "SELECT * FROM TB_ITEM WHERE ID_ITEM = ?";
		try {
    		this.conectar();
   		 	preparedStatement = this.conexao.prepareStatement(sql);
   		 	preparedStatement.setLong(1, id);
		 	System.out.println(preparedStatement.toString());
   		 	resultSet = preparedStatement.executeQuery();
   		 	return resultSetToItem(resultSet);
        } catch (SQLException e) {
       	 	throw new DbException(e.getMessage());
        }
	}
	
	private ItemEntity resultSetToItem(ResultSet resultSet) throws SQLException {
		ItemEntity item = null;
		if (resultSet.next())
			item = new ItemEntity(
					resultSet.getLong("ID_ITEM"),
					resultSet.getString("COD_ITEM"),
					resultSet.getInt("QTDE"),
					resultSet.getDouble("VALOR_UNITARIO"),
					resultSet.getDouble("VALOR_TOTAL"),
					resultSet.getDouble("VALOR_RECEBIDO"));
    	this.desconectar(this.conexao);
    	return item != null ? item : null;
    }

}
